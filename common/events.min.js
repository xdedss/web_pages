var events={};!function(e){function t(e,t,a){if(t[1]==a[1])return!1;if(t[1]>a[1]){var n=a;a=t,t=n}return!(t[1]>e[1]||a[1]<=e[1])&&(r=e[1],i=t[1],l=a[1],u=t[0],o=a[0],u+(o-u)*(r-i)/(l-i))<=e[0];var r,i,l,u,o}function a(e,a){if(a.length<2)return!1;if(2==a.length)return n(e,a[0],a[1]);for(var r=0,i=0;i<a.length-1;i++)t(e,a[i],a[i+1])&&r++;return t(e,a[i],a[0])&&r++,r%2==1}function n(e,t,a){return e[0]>=Math.min(t[0],a[0])&&e[0]<Math.max(t[0],a[0])&&e[1]>=Math.min(t[1],a[1])&&e[1]<Math.max(t[1],a[1])}function r(e){if(0==e.length)return null;for(var t=[e[0][0],e[0][1]],a=[e[0][0],e[0][1]],n=1;n<e.length;n++)e[n][0]<t[0]&&(t[0]=e[n][0]),e[n][0]>a[0]&&(a[0]=e[n][0]),e[n][1]<t[1]&&(t[1]=e[n][1]),e[n][1]>a[1]&&(a[1]=e[n][1]);return[t,a]}var i=[];e(window).on("mousemove",function(e){for(var t=[e.pageX,e.pageY],a=0;a<i.length;a++){var r=i[a],l=r.rect();n(t,l[0],l[1])?(r.active=!0,e.relativeX=e.pageX-l[0][0],e.relativeY=e.pageY-l[0][1],r.updateMove(e)):r.active&&(r.active=!1,e.relativeX=-1,e.relativeY=-1,r.updateMove(e))}}).on("mousedown",function(e){for(var t=[e.pageX,e.pageY],a=0;a<i.length;a++){var r=i[a],l=r.rect();n(t,l[0],l[1])&&(e.relativeX=e.pageX-l[0][0],e.relativeY=e.pageY-l[0][1],r.updateDown(e))}}).on("mouseup",function(e){for(var t=[e.pageX,e.pageY],a=0;a<i.length;a++){var r=i[a],l=r.rect();n(t,l[0],l[1])&&(e.relativeX=e.pageX-l[0][0],e.relativeY=e.pageY-l[0][1],r.updateUp(e))}}).on("contextmenu",function(e){for(var t=[e.pageX,e.pageY],a=0;a<i.length;a++){var r=i[a],l=r.rect();n(t,l[0],l[1])&&(e.relativeX=e.pageX-l[0][0],e.relativeY=e.pageY-l[0][1],r.updateMenu(e))}}),events.registerArea=function(t){if(t instanceof HTMLElement){var l=t;t=function(){var t=e(l),a=t.position(),n=t.outerWidth(),r=t.outerHeight();return[[a.left,a.top],[a.left+n,a.top+r]]}}var u={shapes:[],activeShape:null,active:!1,downShape:null,registerListener:function(e,t,a){void 0===a&&(a=0);var n,i=e,l=a,u=t;if("function"!=typeof e){var o=r(e);e=(()=>i),n=(()=>o)}else n=function(){return r(this.vertices())};"function"==typeof t&&(t={click:u}),"function"!=typeof a&&(a=(()=>l)),this.shapes.push({vertices:e,bound:n,listeners:t,index:a,tryCall:function(e,t){var a=this.listeners[e];void 0!==a&&(t.innerType=e,a(t))}})},raycast:function(e){for(var t=[],r=0;r<this.shapes.length;r++){var i=this.shapes[r],l=i.bound();n(e,l[0],l[1])&&a(e,i.vertices())&&t.push(i)}if(0==t.length)return null;var u=t[0],o=t[0].index();for(r=1;r<t.length;r++){var v=t[r].index();v>=o&&(o=v,u=t[r])}return u},updateMove:function(e){if(-1==e.relativeX)return null!=this.activeShape&&this.activeShape.tryCall("mouseleave",e),this.activeShape=null,this.downShape=null,null;var t=[e.relativeX,e.relativeY],a=this.raycast(t);a!=this.activeShape&&(null!=this.activeShape&&this.activeShape.tryCall("mouseleave",e),null!=a&&a.tryCall("mouseenter",e)),null!=a&&a.tryCall("mousemove",e),a!=this.downShape&&(this.downShape=null),this.activeShape=a},updateUp:function(e){var t=[e.relativeX,e.relativeY],a=this.raycast(t);null!=a&&(a.tryCall("mouseup",e),this.downShape==a&&1==e.which&&a.tryCall("click",e)),this.downShape=null},updateDown:function(e){var t=[e.relativeX,e.relativeY],a=this.raycast(t);null!=a&&(a.tryCall("mousedown",e),1==e.which&&(this.downShape=a))},updateMenu:function(e){var t=[e.relativeX,e.relativeY],a=this.raycast(t);null!=a&&a.tryCall("contextmenu",e)}};return u.rect="function"==typeof t?t:()=>t,i.push(u),u}}(jQuery);